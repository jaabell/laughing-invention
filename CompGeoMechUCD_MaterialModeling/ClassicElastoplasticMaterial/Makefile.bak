# Example Makefile
#
# Use this makefile to compile any .cpp file generated by essi simulator -c opion.
#
#  A .cpp file generated with the `-c` option (e.g. `essi -ncf <filename.fei> `) might need
# some tweaking before being 100% correct C++ code.
#
#

#These lines should point to Makefile.Includes and Makefile.Compiles files.
include ../../Makefile.Includes
include ../../Makefile.Compilers

#Will try to compile all .cpp files in current directory.
SRCS = $(wildcard *.cpp) 
OBJS = $(SRCS:.cpp=.o)
TARGETS = $(patsubst %.cpp, % , $(SRCS))

LIBSHERE = $(LIBS)
CPPFLAGS=--std=c++11 -g -pg
LIBRARY_Constitutive_Models  = ../../lib/libclassicelastoplasticmaterials.a


ALLSRCS = $(SRCS) $(wildcard EvolvingVariables/*.cpp) $(wildcard ElasticityModels/*.cpp) $(wildcard ConstitutiveModels/*.cpp)
ALLOBJS = $(ALLSRCS:.cpp=.o)

#Rules
%.o: %.cpp
	$(CXX) $(CPPFLAGS) $(INCLUDES) -c $< -o $@

# all:  test_yield_surface_and_plastic_flow test_elasticity test_materialinternalvariables
all:  ClassicElastoplasticityGlobals.o 
	$(CD) EvolvingVariables; $(MAKE);
	$(CD) ElasticityModels; $(MAKE);
	$(CD) ConstitutiveModels; $(MAKE);
	$(AR) $(ARFLAGS) $(LIBRARY_Constitutive_Models) $(ALLOBJS)
tests:	all test_drucker test_vonmises 


% : %.o
	$(LINKER) $(LINKFLAGS) $< $(LIBS) -o $@

.PHONY: test_drucker
test_drucker : test_drucker.o 
	$(CXX) $(LINKFLAGS) $< $(LIBSHERE) -o $@
	rm test_drucker.o

.PHONY: test_vonmises
test_vonmises : test_vonmises.o 
	$(CXX) $(LINKFLAGS) $< $(LIBSHERE) -o $@
	rm test_vonmises.o


###########################################################################


clean: cleanall

cleanall:
	$(RM) $(RMFLAGS) $(OBJS) *.o core* *.feioutput *.err
	$(RM) $(RMFLAGS) $(TARGETS)
	$(CD) ConstitutiveModels; $(MAKE);




